<!--pages/activity-detail/index.wxml-->
<view class="container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading">
    <text>åŠ è½½ä¸­...</text>
  </view>
  
  <view wx:elif="{{activity}}" class="activity-detail">
    <!-- æ´»åŠ¨å›¾ç‰‡ -->
    <view class="activity-images">
      <swiper wx:if="{{activity.images && activity.images.length > 0}}" class="image-swiper" indicator-dots="{{true}}" autoplay="{{true}}" interval="3000">
        <swiper-item wx:for="{{activity.images}}" wx:key="*this">
          <image class="activity-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-current="{{item}}"></image>
        </swiper-item>
      </swiper>
      <image wx:else class="activity-image" src="/images/avatar.jpg" mode="aspectFill"></image>
    </view>

    <!-- æ´»åŠ¨åŸºæœ¬ä¿¡æ¯ -->
    <view class="activity-info">
      <view class="activity-header">
        <text class="activity-title">{{activity.title}}</text>
        <view class="activity-status {{activity.status === 'è¿›è¡Œä¸­' ? 'ongoing' : activity.status === 'å·²ç»“æŸ' ? 'ended' : 'upcoming'}}">
          {{activity.status}}
        </view>
      </view>
      
      <view class="activity-meta">
        <view class="meta-item">
          <text class="meta-icon">ğŸ•</text>
          <text class="meta-text">{{activity.startTime}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ“</text>
          <text class="meta-text">{{activity.location}}</text>
        </view>
        <view class="meta-item">
          <text class="meta-icon">ğŸ‘¥</text>
          <text class="meta-text">{{registrationCount}}/{{activity.maxParticipants || 'ä¸é™'}}äºº</text>
        </view>
      </view>
    </view>

    <!-- æ´»åŠ¨æè¿° -->
    <view class="activity-section">
      <view class="section-title">æ´»åŠ¨ä»‹ç»</view>
      <text class="activity-description">{{activity.description}}</text>
    </view>

    <!-- æ´»åŠ¨è¯¦æƒ… -->
    <view class="activity-section">
      <view class="section-title">æ´»åŠ¨è¯¦æƒ…</view>
      <view class="detail-list">
        <view class="detail-item">
          <text class="detail-label">æ´»åŠ¨æ—¶é—´ï¼š</text>
          <text class="detail-value">{{activity.startTime}} - {{activity.endTime}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ´»åŠ¨åœ°ç‚¹ï¼š</text>
          <text class="detail-value">{{activity.location}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æŠ¥åæˆªæ­¢ï¼š</text>
          <text class="detail-value">{{activity.registrationDeadline}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ´»åŠ¨è´¹ç”¨ï¼š</text>
          <text class="detail-value">{{activity.fee || 'å…è´¹'}}</text>
        </view>
      </view>
    </view>

    <!-- è”ç³»æ–¹å¼ -->
    <view wx:if="{{activity.contactPhone || activity.contactWechat}}" class="activity-section">
      <view class="section-title">è”ç³»æ–¹å¼</view>
      <view class="contact-list">
        <view wx:if="{{activity.contactPhone}}" class="contact-item" bindtap="makePhoneCall">
          <text class="contact-icon">ğŸ“</text>
          <text class="contact-text">{{activity.contactPhone}}</text>
          <text class="contact-action">æ‹¨æ‰“</text>
        </view>
        <view wx:if="{{activity.contactWechat}}" class="contact-item" bindtap="copyWechat">
          <text class="contact-icon">ğŸ’¬</text>
          <text class="contact-text">{{activity.contactWechat}}</text>
          <text class="contact-action">å¤åˆ¶</text>
        </view>
      </view>
    </view>

    <!-- åˆ†äº«åŠŸèƒ½ -->
    <view class="activity-section">
      <view class="section-title">åˆ†äº«æ´»åŠ¨</view>
      <view class="share-actions">
        <view class="share-item" bindtap="shareActivity">
          <text class="share-icon">ğŸ“¤</text>
          <text class="share-text">åˆ†äº«æ´»åŠ¨</text>
        </view>
        <view class="share-tips">
          <text>ç‚¹å‡»åˆ†äº«æŒ‰é’®ï¼Œå°†æ´»åŠ¨åˆ†äº«ç»™å¥½å‹æˆ–æœ‹å‹åœˆ</text>
        </view>
      </view>
    </view>

    <!-- æŠ¥åçŠ¶æ€ -->
    <view class="registration-status">
      <view wx:if="{{myRegistration}}" class="status-info">
        <text class="status-text">æ‚¨å·²æŠ¥åæ­¤æ´»åŠ¨</text>
        <text class="status-time">æŠ¥åæ—¶é—´ï¼š{{myRegistration.registerTime}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <view wx:if="{{!myRegistration && activity.status !== 'å·²ç»“æŸ'}}" class="register-btn" bindtap="registerActivity">
      ç«‹å³æŠ¥å
    </view>
    <view wx:elif="{{myRegistration && myRegistration.status === 'å·²æŠ¥å'}}" class="cancel-btn" bindtap="cancelRegistration">
      å–æ¶ˆæŠ¥å
    </view>
    <view wx:elif="{{activity.status === 'å·²ç»“æŸ'}}" class="disabled-btn">
      æ´»åŠ¨å·²ç»“æŸ
    </view>
  </view>
</view> 