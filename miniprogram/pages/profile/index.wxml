<!--pages/profile/index.wxml-->
<view class="container">
  <!-- 未登录状态 -->
  <view wx:if="{{!isLoggedIn}}" class="login-container">
    <view class="login-content">
      <image class="login-avatar" src="/images/avatar.png" mode="aspectFill"></image>
      <text class="login-title">欢迎使用移动应用开发社团</text>
      <text class="login-desc">请先登录以查看个人信息</text>
      <button class="login-btn" bindtap="wxLogin">微信登录</button>
    </view>
  </view>

  <!-- 已登录状态 -->
  <view wx:else>
    <!-- 用户信息区域 -->
    <view class="user-profile">
      <view class="profile-header">
        <view class="profile-info">
          <image class="user-avatar" src="{{userInfo.avatar}}" mode="aspectFill"></image>
          <view class="user-details">
            <text class="user-name">{{userInfo.name}}</text>
            <text class="user-major">{{userInfo.major}}</text>
          </view>
        </view>
        <view class="profile-actions">
          <view class="action-btn" bindtap="onMoreOptions">
            <text class="action-icon">⋯</text>
          </view>
          <!--设置功能。先不开发-->
          <!-- <view class="action-btn" bindtap="onSettings">
            <text class="action-icon">⚙️</text>
          </view> -->
        </view>
      </view>
      
      <!-- 统计数据 -->
      <view class="statistics">
        <view class="stat-item">
          <text class="stat-number">{{statistics.participatedActivities}}</text>
          <text class="stat-label">参与活动</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{statistics.organizedActivities}}</text>
          <text class="stat-label">组织活动</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{statistics.unreadMessages}}</text>
          <text class="stat-label">未读消息</text>
        </view>
      </view>
    </view>

    <!-- 我的活动 -->
    <view class="my-activities">
      <view class="section-header" bindtap="viewMyActivities">
        <text class="section-title">我的活动</text>
        <text class="section-arrow">></text>
      </view>
      
      <!-- 活动列表 -->
      <view class="activity-list">
        <view wx:if="{{loading}}" class="loading">
          <text>加载中...</text>
        </view>
        
        <view wx:elif="{{myActivities.length === 0}}" class="empty-state">
          <text>暂无活动记录</text>
        </view>
        
        <view wx:else class="activity-items">
          <view 
            wx:for="{{myActivities}}" 
            wx:key="_id"
            class="activity-item"
            bindtap="onActivityTap"
            data-id="{{item._id}}"
          >
            <view class="activity-info">
              <text class="activity-title">{{item.title}}</text>
              <view class="activity-time">
                <text class="time-icon">📅</text>
                <text class="time-text">{{item.startTime}}</text>
              </view>
            </view>
            <view class="activity-status {{item.status === '进行中' ? 'ongoing' : item.status === '已结束' ? 'ended' : 'reviewing'}}">
              {{item.status}}
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- 功能菜单 -->
    <view class="function-menu">
      <view class="menu-section">
        <view class="menu-item" bindtap="editProfile">
          <text class="menu-icon">👤</text>
          <text class="menu-title">编辑资料</text>
          <text class="menu-arrow">></text>
        </view>
        <view class="menu-item" bindtap="messageCenter">
          <text class="menu-icon">💬</text>
          <text class="menu-title">消息中心</text>
          <text class="menu-arrow">></text>
        </view>
      </view>
      
      <view class="menu-section">
        <view class="menu-item" bindtap="helpFeedback">
          <text class="menu-icon">❓</text>
          <text class="menu-title">帮助反馈</text>
          <text class="menu-arrow">></text>
        </view>
        <view class="menu-item" bindtap="aboutUs">
          <text class="menu-icon">ℹ️</text>
          <text class="menu-title">关于我们</text>
          <text class="menu-arrow">></text>
        </view>
      </view>
    </view>
  </view>
</view>